<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/layout}">
<head>
    <meta charset="UTF-8">
    <title>객실 예약 관리</title>
    <link rel="stylesheet" th:href="@{/css/reservation.css}"/>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body>
<div layout:fragment="content" class="container mt-4">
    <h2 class="text-center mb-4">객실 예약 관리</h2>

    <!-- 방 목록 -->
    <div class="room-grid mb-4">
        <div class="row row-cols-5 g-3" id="room-list">
            <!-- 방 목록은 JavaScript로 동적으로 렌더링 -->
        </div>
    </div>

    <!-- 방 상세 정보 -->
    <div id="room-details" class="card d-none">
        <div class="card-body">
            <h5 class="card-title">객실 상세 정보</h5>
            <ul class="list-group list-group-flush">
                <li class="list-group-item"><strong>객실 이름:</strong> <span id="room-name"></span></li>
                <li class="list-group-item"><strong>객실 타입:</strong> <span id="room-type"></span></li>
                <li class="list-group-item"><strong>상태:</strong> <span id="room-status"></span></li>
                <li class="list-group-item"><strong>가격:</strong> <span id="room-price"></span></li>
                <li class="list-group-item"><strong>예약 기간:</strong> <span id="reservation-period"></span></li>
            </ul>
            <div class="mt-3">
                <button class="btn btn-primary" id="reserve-room">객실 예약</button>
                <button class="btn btn-danger" id="disable-room">사용 중지</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const roomList = document.getElementById('room-list');
            const roomDetails = document.getElementById('room-details');

            // 방 목록 가져오기
            fetch('/manager/room/reservation/rooms')
                .then(response => response.json())
                .then(rooms => {
                    roomList.innerHTML = '';
                    rooms.forEach(room => {
                        const roomDiv = document.createElement('div');
                        roomDiv.className = 'col';
                        roomDiv.innerHTML = `
                            <div class="card ${room.status === '사용 중' ? 'bg-warning' : room.status === '예약됨' ? 'bg-secondary text-white' : 'bg-light'}">
                                <div class="card-body text-center">
                                    <h5 class="card-title">${room.name}</h5>
                                    <p class="card-text">${room.status}</p>
                                    <button class="btn btn-outline-primary btn-sm view-room-details" data-id="${room.id}">상세 보기</button>
                                </div>
                            </div>`;
                        roomList.appendChild(roomDiv);
                    });

                    // 상세 보기 버튼에 이벤트 추가
                    document.querySelectorAll('.view-room-details').forEach(button => {
                        button.addEventListener('click', () => {
                            fetch(`/manager/room/reservation/room/${button.dataset.id}`)
                                .then(response => response.json())
                                .then(data => {
                                    roomDetails.classList.remove('d-none');
                                    document.getElementById('room-name').textContent = data.name;
                                    document.getElementById('room-type').textContent = data.type;
                                    document.getElementById('room-status').textContent = data.status;
                                    document.getElementById('room-price').textContent = data.price;
                                    document.getElementById('reservation-period').textContent = data.reservationPeriod;
                                });
                        });
                    });
                });
        });
    </script>
</div>
</body>
</html>
