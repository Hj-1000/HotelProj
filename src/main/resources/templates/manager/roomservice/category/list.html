<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/layout}">

<head>
    <meta charset="UTF-8">
    <title>NTT호텔 - 카테고리관리</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script th:inline="javascript">
        $(document).ready(function () {
            var message = [[${message}]];
            if (message != null && message != '') {
                alert(message);
            }

            var moBtn = $(".modalBtn");
            var modal = $("#myModal");

            moBtn.off().on("click", function () {
                modal.modal("show");
                $('.modal-title').text("간편 등록하기");
                $("#saveChanges").show();
                modal.find("input").show();
            });

            $(".submitBtn").off().on("click", function () {
                alert("글 작성이 완료되었습니다.");
            });
        })
    </script>

    <!-- CSS 수정 -->
    <style>
        /* 카테고리 목록의 그리드 스타일 */
        .category-list {
            display: grid;  /* 그리드로 배치 */
            grid-template-columns: repeat(5, 1fr);  /* 한 줄에 5개씩 */
            gap: 15px;  /* 항목 사이 간격 */
            margin-top: 20px;
        }

        .category-item {
            position: relative;  /* relative를 추가하여 절대 위치를 기준으로 설정 */
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 8px;
            background-color: #f9f9f9;
            box-sizing: border-box;
            text-align: center;
            height: 160px;
        }

        .category-item .no {
            font-weight: bold;
            font-size: 18px;
            color: #333;
        }

        .category-item .name {
            margin-top: 10px;
            font-size: 16px;
            color: #007bff;
        }

        /* 삭제 버튼 스타일 */
        .category-item .delete {
            position: absolute;  /* 버튼을 절대 위치로 설정 */
            bottom: 10px;  /* 하단에서 10px 위로 위치 */
            right: 10px;  /* 우측에서 10px 떨어진 위치 */
            padding: 3px 8px;
            background-color: #dc3545;
            color: white;
            border-radius: 5px;
            text-decoration: none;
            text-align: center;
            width: auto;
            cursor: pointer;
            font-size: 14px;
        }

        .category-item .delete:hover {
            background-color: #c82333;
        }

        .category-item .delete a {
            color: white;
        }

    </style>
</head>

<body>

<div id="wrapper" layout:fragment="content">
    <div class="container-fluid mt-4">
        <h2 class="mb-3">서비스 카테고리 관리</h2>

        <!-- 검색 영역 -->
        <div class="card p-4 mb-4">
            <form action="/roomService/category/list" method="get">
                <div class="row g-3 align-items-center">
                    <h5 class="card-title">카테고리 찾기</h5>
                    <div class="col-md-6">
                        <select name="searchType" class="form-select">
                            <option value="name" th:selected="${searchType == 'name'}">카테고리명</option>
                        </select>
                    </div>
                    <div class="col-md-6">
                        <input type="text" name="keyword" class="form-control" placeholder="검색어를 입력하세요">
                    </div>
                </div>
                <!-- 조회 버튼 -->
                <div class="text-center mt-4">
                    <button type="submit" class="btn btn-primary w-25" style="background-color: black">조회</button>
                </div>
            </form>
        </div>

        <!-- 카테고리 목록 영역 -->
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">카테고리 목록</h5>

                <div class="category-list">
                    <th:block th:unless="${#lists.isEmpty(serviceCateDTOS)}">
                        <!-- 두 개씩 나열하기 위한 그리드 구조 -->
                        <th:block th:each="data, status : ${serviceCateDTOS}">
                            <div class="category-item">
                                <div class="no" th:text="${status.index + 1}"></div>
                                <div class="name">
                                    <a th:href="@{/roomService/category/read(serviceCateId=${data.serviceCateId})}" style="text-decoration: none" th:text="${data.serviceCateName}">한식</a>
                                </div>
                                <div class="delete">
                                    <a th:href="@{/roomService/category/delete(serviceCateId=${data.serviceCateId})}" style="text-decoration: none" class="badge bg-danger delBtn">삭제</a>
                                </div>
                            </div>
                        </th:block>
                    </th:block>

                    <th:block th:if="${#lists.isEmpty(serviceCateDTOS)}">
                        <div style="text-align: center">
                            <p>등록된 카테고리가 없습니다.</p>
                        </div>
                    </th:block>
                </div>

                <!-- 추가 버튼 -->
                <div class="text-end mt-3">
                    <button class="btn btn-primary" style="background-color: black" onclick="location.href='/roomService/category/register' ">등록</button>
                    <button type="button" class="btn btn-primary modalBtn">간편 등록</button>
                </div>
            </div>
        </div>

        <!-- 페이지네이션 -->
        <div class="d-flex justify-content-center">
            <ul class="pagination">
                <li class="page-item" th:unless="${pageInfo.startPage == 1}">
                    <a class="page-link" th:href="@{/roomService/category/list(page=1)}">시작</a>
                </li>
                <li class="page-item" th:unless="${pageInfo.currentPage == 1}">
                    <a class="page-link" th:href="@{/roomService/category/list(page=${pageInfo.prevPage})}">이전</a>
                </li>
                <th:block th:each="num : ${#numbers.sequence(pageInfo.startPage, pageInfo.endPage, 1)}">
                    <li class="page-item" th:unless="${num == pageInfo.currentPage}">
                        <a class="page-link" th:href="@{/roomService/category/list(page=${num})}" th:text="${num}">1</a>
                    </li>
                    <li class="page-item active" th:if="${num == pageInfo.currentPage}">
                        <a class="page-link" th:href="@{/roomService/category/list(page=${num})}" th:text="${num}">[[${num}]]</a>
                    </li>
                </th:block>
                <li class="page-item" th:unless="${pageInfo.currentPage >= pageInfo.lastPage}">
                    <a class="page-link" th:href="@{/roomService/category/list(page=${pageInfo.nextPage})}">다음</a>
                </li>
                <li class="page-item" th:unless="${pageInfo.endPage == pageInfo.lastPage}">
                    <a class="page-link" th:href="@{/roomService/category/list(page=${pageInfo.lastPage})}">끝</a>
                </li>
            </ul>
        </div>

    </div>
</div>

<!-- 모달 -->
<div class="modal" id="myModal">
    <div class="modal-dialog">
        <div class="modal-content">
            <!-- Modal Header -->
            <div class="modal-header">
                <h4 class="modal-title">간편등록</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <form action="/roomService/category/register" method="post" enctype="multipart/form-data">
                <!-- Modal body -->
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="serviceCateName" class="form-label">카테고리명:</label>
                        <input type="text" class="form-control" id="serviceCateName" name="serviceCateName">
                    </div>
                    <!-- 새 이미지 업로드 및 미리보기 -->
                    <div>
                        <label for="newImageFiles">카테고리이미지:</label>
                        <input type="file" id="newImageFiles" name="imageFiles" multiple onchange="previewImage(event)">
                        <br><small>이미지를 선택해 주세요.</small>
                    </div>

                    <!-- 미리보기 이미지 표시 -->
                    <div id="imagePreviewContainer">
                        <!-- 미리보기가 여기 나타날 것입니다 -->
                    </div>
                </div>

                <!-- Modal footer -->
                <div class="modal-footer">
                    <button type="button" class="btn btn-light" data-bs-dismiss="modal">닫기</button>
                    <button type="submit" class="btn btn-primary" data-bs-dismiss="modal">등록</button>
                </div>

            </form>

        </div>
    </div>
</div>

</body>
</html>
