<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>서비스 주문 페이지</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
<div class="container mt-4">
    <h2 class="mb-3">서비스 카테고리</h2>
    <div id="categories" class="d-flex flex-wrap gap-3">
        <!-- 카테고리 목록 동적 생성 -->
    </div>

    <h2 class="mt-4">메뉴 목록</h2>
    <div id="menus" class="row">
        <!-- 선택된 카테고리의 메뉴 목록 동적 생성 -->
    </div>

    <h2 class="mt-4">장바구니</h2>
    <table class="table table-bordered">
        <thead>
        <tr>
            <th>메뉴 이름</th>
            <th>수량</th>
            <th>가격</th>
            <th>삭제</th>
        </tr>
        </thead>
        <tbody id="cartItems">
        <!-- 장바구니 목록 동적 생성 -->
        </tbody>
    </table>
    <button class="btn btn-primary" id="placeOrder">주문하기</button>
</div>

<script>
    $(document).ready(function() {
        const apiBaseUrl = '/api'; // API 기본 경로
        let cart = []; // 장바구니 데이터

        // 카테고리 불러오기
        $.get(${apiBaseUrl}/categories, function(categories) {
        categories.forEach(category => {
            $('#categories').append(<button class="btn btn-outline-primary category-btn" data-id="${category.serviceCateId}">${category.serviceCateName}</button>);
        });
    });

    // 카테고리 클릭 시 메뉴 불러오기
    $(document).on('click', '.category-btn', function() {
        const categoryId = $(this).data('id');
        $('#menus').empty();
        $.get(${apiBaseUrl}/menus?categoryId=${categoryId}, function(menus) {
        menus.forEach(menu => {
            $('#menus').append(
                <div class="col-md-4">
                    <div class="card">
                        <img src="${menu.imagePath}" class="card-img-top" alt="${menu.serviceMenuName}">
                            <div class="card-body">
                                <h5 class="card-title">${menu.serviceMenuName}</h5>
                                <p class="card-text">${menu.serviceMenuInfo}</p>
                                <p class="card-text">가격: ${menu.serviceMenuPrice}원</p>
                                <button class="btn btn-success add-to-cart" data-id="${menu.serviceMenuId}" data-name="${menu.serviceMenuName}" data-price="${menu.serviceMenuPrice}">장바구니 추가</button>
                            </div>
                    </div>
                </div>
        );
        });
        });
        });

        // 장바구니 추가 기능
        $(document).on('click', '.add-to-cart', function() {
            const menuId = $(this).data('id');
            const menuName = $(this).data('name');
            const menuPrice = $(this).data('price');

            const existingItem = cart.find(item => item.id === menuId);
            if (existingItem) {
                existingItem.count++;
            } else {
                cart.push({ id: menuId, name: menuName, price: menuPrice, count: 1 });
            }
            updateCart();
        });

        // 장바구니 업데이트
        function updateCart() {
            $('#cartItems').empty();
            cart.forEach(item => {
                $('#cartItems').append(
                    <tr>
                        <td>${item.name}</td>
                        <td>${item.count}</td>
                        <td>${item.price * item.count}원</td>
                        <td><button class="btn btn-danger remove-item" data-id="${item.id}">삭제</button></td>
                    </tr>
                );
            });
        }

        // 장바구니에서 아이템 삭제
        $(document).on('click', '.remove-item', function() {
            const menuId = $(this).data('id');
            cart = cart.filter(item => item.id !== menuId);
            updateCart();
        });

        // 주문하기
        $('#placeOrder').click(function() {
            if (cart.length === 0) {
                alert('장바구니가 비어 있습니다.');
                return;
            }
            $.ajax({
                url: ${apiBaseUrl}/orders,
            method: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(cart),
                success: function(response) {
                alert('주문이 완료되었습니다!');
                cart = [];
                updateCart();
            },
            error: function() {
                alert('주문 처리 중 오류가 발생했습니다.');
            }
        });
</script>
</body>
</html>