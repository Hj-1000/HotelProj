<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>
    <meta charset="UTF-8">
    <title>[[${hotelDTO.hotelName}]], [[${hotelDTO.hotelLocation}]] 호텔</title>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://kit.fontawesome.com/b17b1596b8.js" crossorigin="anonymous"></script>
    <link rel ="stylesheet" href="/assets/fonts/fontawesome-all.min.css">
    <link rel ="stylesheet" href="/assets/css/bootstrap.min.css">
    <link rel ="stylesheet" href="/assets/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" th:href="@{/css/user.css}">
    <link rel="stylesheet" th:href="@{/css/roomList.css}">

    <style>

        .hotel-images {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            grid-template-rows: repeat(2, 1fr);
            gap: 10px;
            padding: 10px;
            height: 400px;
            /*border: 1px solid purple;*/
        }
        .hotel-images img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 5px;
            /*border:1px solid orange;*/
        }
        .hotel-images img:first-child {
            grid-row: span 2;
        }
        /*!* 슬라이드 이미지의 컨테이너 *!
        .carousel-inner {
            position: relative;
            width: 100%;
            height: 500px; !* 고정된 높이 *!
        }

        .carousel-item {
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        !* 이미지 스타일 *!
        .hotelImg {
            width: 100%;
            height: 100%;
            object-fit: cover; !* 이미지 비율 맞추기 *!
            object-position: center; !* 이미지 중앙에 맞추기 *!
        }

        !* carousel-item을 고정하여 전환 시 크기 변화 방지 *!
        .carousel-item-next, .carousel-item-prev, .carousel-item.active {
            display: block;
            transition: transform 0.5s ease-in-out;
        }*/
    </style>


    <script th:inline="javascript">

        window.onload = function() {

            // 세션에서 message 값을 가져옴
            var message = [[${message}]];

            // message가 null이 아니면 알림창을 띄우고 세션에서 삭제
            if (message !== null && message !== '') {
                alert(message);
            }

            var hotelId = $(".likeBtn").data("hotel-id"); // HTML에서 안전하게 hotelId 가져오기
            console.log("hotelId from data attribute:", hotelId); // ✅ 값이 숫자로 나오는지 확인

            if (!hotelId || isNaN(hotelId)) {
                console.error("잘못된 hotelId:", hotelId);
                return;
            }

            //비회원용 스크랩 버튼(로그인하면 안보임)
            var nya = $(".nya")
            nya.show()

            var url = "/like/check/" + hotelId

            $.ajax({
                url: url,
                type: "GET",
                data: { hotelId: hotelId },
                success: function (isLiked) {
                    console.log("찜 여부 확인 결과:", isLiked); // ✅ true 또는 false 확인
                    if (isLiked) {
                        $(".likeBtn").hide();
                        $(".delBtn").show();
                    } else {
                        $(".likeBtn").show();
                        $(".delBtn").hide();
                    }
                },
                error: function () {
                    console.error("찜 여부 확인 AJAX 요청 실패");
                }
            });

        }

        function page(page) {
            location.href= "/hotel/list/" + page
        }

        //찜 버튼을 클릭했을 때 실행 할 함수
        function addLike() {
            console.log("찜하기 실행");

            var hotelId = [[${hotelDTO.hotelId}]];
            var param = {
                hotelId: hotelId
            };

            $.ajax({
                url: "/like/register",
                type: "POST",
                contentType: "application/json; charset=utf-8",
                data: JSON.stringify(param),
                dataType: "json",
                success: function (result, status) {
                    alert("스크랩 되었습니다.");
                    $(".likeBtn").hide();
                    $(".delBtn").show();
                    location.reload();

                },
                error: function (result, status, error) {
                    if (result.status == 401) {
                        alert("로그인 후 이용해주세요.");
                        location.href = "/login";
                    } else {
                        alert(result.responseText);
                        location.reload();
                    }
                }
            });
        }


        function delLike() {
            console.log("찜 삭제 실행");

            var hotelId = [[${hotelDTO.hotelId}]]; // 호텔 ID 가져오기
            var paramData = {
                hotelId: hotelId
            };

            $.ajax({
                url: "/like/delete",
                type: "POST",
                contentType: "application/json; charset=utf-8",
                data: JSON.stringify(paramData),
                success: function (result) {
                    alert("스크랩이 취소 되었습니다.");
                    $(".likeBtn").show();
                    $(".delBtn").hide();
                    location.reload();  // ✅ 페이지 새로고침
                },
                error: function (xhr) {
                    console.error("삭제 실패:", xhr.responseText);
                    alert("삭제 실패: " + xhr.responseText);
                }
            });
        }





    </script>

</head>
<body>
<div th:replace="~{fragments/header::header}"></div>

<div layout:fragment="content">

    <div class="row mb-3" style="width: 1000px; margin: auto">
        <div class="col">
            <div class="card border-light">
                <!-- 호텔 상세부분 -->
                <div class="row g-0 hotel-card">
                    <div >

                        <div class="hotel-images">
                            <!-- 1. 호텔 메인 이미지 추가 (첫 번째 호텔 이미지) -->
                            <th:block th:if="${hotelDTO.hotelImgDTOList.size() > 0}">
                                <img th:src="@{'/upload/' + ${hotelDTO.hotelImgDTOList[0].imagePath}}" class="hotelmain" alt="호텔 메인">
                            </th:block>

                            <!-- 2. 나머지 호텔 이미지 추가 (2번째부터) -->
                            <th:block th:each="img, iterStat : ${hotelDTO.hotelImgDTOList}" th:if="${iterStat.index > 0}">
                                <img th:src="@{'/upload/' + ${img.imagePath}}" class="hotelroom" alt="호텔 이미지">
                            </th:block>

                            <!-- 3. 호텔 이미지가 5개보다 적다면 객실 이미지로 부족한 칸을 채우기 -->
                            <th:block th:if="${hotelDTO.hotelImgDTOList.size() < 5}">
                                <th:block th:each="room : ${rooms}">
                                    <th:block th:each="roomImg, imgStat : ${room.roomImageDTOList}" th:if="${hotelDTO.hotelImgDTOList.size() + imgStat.index < 5}">
                                        <img th:src="@{'/upload/' + ${roomImg.imagePath}}" class="hotelroom" alt="객실 이미지">
                                    </th:block>
                                </th:block>
                            </th:block>
                        </div>


                        <!--슬라이드였던것-->
                        <!--<div id="carouselExampleIndicators" class="carousel slide">
                            <div class="carousel-indicators">
                                <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
                                <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="1" aria-label="Slide 2"></button>
                                <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="2" aria-label="Slide 3"></button>
                            </div>
                            <div class="carousel-inner">
                                &lt;!&ndash; 이미지가 있는 슬라이드를 생성 &ndash;&gt;
                                <th:block th:each="img, iterStat : ${hotelDTO.hotelImgDTOList}">
                                    <div class="carousel-item image-box" th:classappend="${iterStat.index == 0 ? ' active' : ''}">
                                        <img th:src="@{'/upload/' + ${img.imagePath}}" class="hotelImg" alt="hotel Image" width="100%" />
                                    </div>
                                </th:block>

                                &lt;!&ndash; 기본 이미지를 채우기 위한 부분 (이미지가 부족할 때) &ndash;&gt;
                                <th:block th:if="${hotelDTO.hotelImgDTOList.size() < 3}">
                                    &lt;!&ndash; 1개의 기본 이미지 추가 &ndash;&gt;
                                    <div class="carousel-item image-box" th:classappend="${hotelDTO.hotelImgDTOList.size() == 0 ? ' active' : ''}">
                                        <img src="/img/default_img.jpg" class="hotelImg" alt="default Image" width="100%" />
                                    </div>
                                </th:block>
                                <th:block th:if="${hotelDTO.hotelImgDTOList.size() == 1}">
                                    &lt;!&ndash; 2개의 기본 이미지 추가 &ndash;&gt;
                                    <div class="carousel-item image-box">
                                        <img src="/img/default_img.jpg" class="hotelImg" alt="default Image" width="100%" />
                                    </div>
                                </th:block>
                                <th:block th:if="${hotelDTO.hotelImgDTOList.size() == 2}">
                                    &lt;!&ndash; 1개의 기본 이미지 추가 &ndash;&gt;
                                    <div class="carousel-item image-box">
                                        <img src="/img/default_img.jpg" class="hotelImg" alt="default Image" width="100%" />
                                    </div>
                                </th:block>
                            </div>
                            <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide="prev">
                                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                <span class="visually-hidden">Previous</span>
                            </button>
                            <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide="next">
                                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                <span class="visually-hidden">Next</span>
                            </button>
                        </div>-->

                        <div>
                            <!--등록한 사진이 없을 때-->
                            <th:block th:unless="${hotelDTO.hotelImgDTOList.size() != 0}">
                                <div>
                                    <img src="/img/default_img.jpg" alt="noImage" style="width: 300px"/>
                                </div>
                            </th:block>
                        </div>
                    </div>
                    <div >
                        <div class="card-body">
                            <div class="mb-3">
                                &nbsp<a th:href="@{'/hotel/list?searchType=location&keyword=' + ${hotelDTO.hotelLocation}}" style="text-decoration: none"><span th:text="${hotelDTO.hotelLocation}" style="font-size: small; color: darkgray">호텔 지역</span></a><span th:text="' ㅣ '+${hotelDTO.companyName}" style="font-size: small; color: darkgray">본사명</span>
                                <h2 th:text="${hotelDTO.hotelName}">호텔(지사)이름</h2>
                            </div>



                            <div class="mb-3">

                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-geo-alt" viewBox="0 0 16 16">
                                    <path d="M12.166 8.94c-.524 1.062-1.234 2.12-1.96 3.07A32 32 0 0 1 8 14.58a32 32 0 0 1-2.206-2.57c-.726-.95-1.436-2.008-1.96-3.07C3.304 7.867 3 6.862 3 6a5 5 0 0 1 10 0c0 .862-.305 1.867-.834 2.94M8 16s6-5.686 6-10A6 6 0 0 0 2 6c0 4.314 6 10 6 10"></path>
                                    <path d="M8 8a2 2 0 1 1 0-4 2 2 0 0 1 0 4m0 1a3 3 0 1 0 0-6 3 3 0 0 0 0 6"></path>
                                </svg>

                                <span th:text="${hotelDTO.hotelAddress}">주소</span>

                            </div>


<!--                            <span th:text="${hotelDTO.hotelInfo}">상세정보</span>-->

                            <div class="text-end mb-3 me-3" style="margin-top: -50px;">
                                <div>
                                    <!-- 찜 추가 버튼 (처음에는 보이게 설정) -->
                                    <button class="btn btn-outline-danger likeBtn" th:data-hotel-id="${hotelDTO.hotelId}" onclick="addLike()" style="width: 120px; display: none;">
                                        스크랩 <i class="fa-regular fa-heart"></i>
                                    </button>

                                    <!-- 찜 삭제 버튼 (처음에는 숨김) -->
                                    <button class="btn btn-danger delBtn" th:data-hotel-id="${hotelDTO.hotelId}" onclick="delLike()" style="width: 120px; display: none;">
                                        스크랩 <i class="fa fa-heart" aria-hidden="true"></i>
                                    </button>
                                </div>
                            </div>

                            <div class="text-end mb-3 me-3" th:if="${#authentication.name == 'anonymousUser'}" style="margin-top: -50px;">
                                <div>
                                    <!-- 찜 추가 버튼 (비회원용) -->
                                    <button class="btn btn-outline-danger nya" style="width: 120px; display: none;" onclick="addLike()">
                                        스크랩 <i class="fa-regular fa-heart"></i>
                                    </button>
                                </div>
                            </div>


                        </div>
                    </div>
                </div>



                <!-- 객실 리뷰부분 -->
               <div class="card border-light-shadow" style="width: 950px; margin: auto; padding-top: 17px; padding-bottom: 20px;">
                   <div style="width: 950px; margin: auto">
                       <div style="margin-bottom: -20px">
                           <h4 style="margin-bottom: -24px">&ensp;객실 리뷰</h4> <span>&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&ensp;(<span class="roomReview">2,298</span>)&ensp; <i class="fa-solid fa-star"></i> <span class="hotelRating">4.9</span>점</span>
                       </div>
                       <div style="text-align: right; margin-bottom: 15px; margin-top: -10px; font-size: small">
                           전체보기>&emsp;
                       </div>
                       <div class="row" style="width: 950px; margin: auto">
                           <!--th:if 돌려서 최신리뷰 3개-->
                           <div class="col-4">
                               <div class="card border-light-shadow review-card" style="margin: -3px; padding: 15px; height: 150px">
                                   <!-- 객실 리뷰 -->
                                   <!--별점-->
                                   <p> <i class="fa-solid fa-star" style="margin-right: -3px"></i>
                                       <i class="fa-solid fa-star" style="margin-right: -3px"></i>
                                       <i class="fa-solid fa-star" style="margin-right: -3px"></i>
                                       <i class="fa-solid fa-star" style="margin-right: -3px"></i>
                                       <i class="fa-solid fa-star"></i>
                                   </p>
                                   <!--th:if 별점이 i점 이라면~-->
                                   <!--<p> <i class="fa-solid fa-star" style="margin-right: -3px"></i>
                                       <i class="fa-solid fa-star" style="margin-right: -3px"></i>
                                       <i class="fa-solid fa-star" style="margin-right: -3px"></i>
                                       <i class="fa-solid fa-star" style="margin-right: -3px"></i>
                                       <i class="fa-regular fa-star"></i>
                                   </p>
                                   <p> <i class="fa-solid fa-star" style="margin-right: -3px"></i>
                                       <i class="fa-solid fa-star" style="margin-right: -3px"></i>
                                       <i class="fa-solid fa-star" style="margin-right: -3px"></i>
                                       <i class="fa-regular fa-star" style="margin-right: -3px"></i>
                                       <i class="fa-regular fa-star"></i>
                                   </p>
                                   <p> <i class="fa-solid fa-star" style="margin-right: -3px"></i>
                                       <i class="fa-solid fa-star" style="margin-right: -3px"></i>
                                       <i class="fa-regular fa-star" style="margin-right: -3px"></i>
                                       <i class="fa-regular fa-star" style="margin-right: -3px"></i>
                                       <i class="fa-regular fa-star"></i>
                                   </p>
                                   <p> <i class="fa-solid fa-star" style="margin-right: -3px"></i>
                                       <i class="fa-regular fa-star" style="margin-right: -3px"></i>
                                       <i class="fa-regular fa-star" style="margin-right: -3px"></i>
                                       <i class="fa-regular fa-star" style="margin-right: -3px"></i>
                                       <i class="fa-regular fa-star"></i>
                                   </p>-->
                                   좋아요
                               </div>
                           </div>
                           <div class="col-4">
                               <div class="card border-light-shadow review-card" style="margin: -3px; padding: 15px; height: 150px">
                                   <p> <i class="fa-solid fa-star" style="margin-right: -3px"></i>
                                       <i class="fa-regular fa-star" style="margin-right: -3px"></i>
                                       <i class="fa-regular fa-star" style="margin-right: -3px"></i>
                                       <i class="fa-regular fa-star" style="margin-right: -3px"></i>
                                       <i class="fa-regular fa-star"></i>
                                   </p>
                                   <!-- 객실 리뷰 -->
                                   바퀴벌레나옴
                               </div>
                           </div>
                           <div class="col-4">
                               <div class="card border-light-shadow review-card" style="margin: -3px; padding: 15px; height: 150px">
                                   <!-- 객실 리뷰 -->
                                   <p> <i class="fa-solid fa-star" style="margin-right: -3px"></i>
                                       <i class="fa-solid fa-star" style="margin-right: -3px"></i>
                                       <i class="fa-solid fa-star" style="margin-right: -3px"></i>
                                       <i class="fa-solid fa-star" style="margin-right: -3px"></i>
                                       <i class="fa-regular fa-star"></i>
                                   </p>
                                   좋네요
                               </div>
                           </div>
                       </div>
                   </div>
               </div>

                <!--랄라-->

                <!--예약 날짜 선택-->
                <div style="margin: auto">
                    <div style="margin-top: 50px; width: 930px">
                        <h4> 날짜 선택</h4>
                        <div class="row">
                            <div class="col-6">
                                <input type="date" class="form-control" id="checkInDate" name="checkInDate" required>
                            </div>
                            <div class="col-6">
                                <input type="date" class="form-control" id="checkOutDate" name="checkOutDate" required>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 객실 목록 -->
                <div class="col ">
                    <div >


                        <!--<h3 th:text="${hotelDTO.hotelName}">호텔(지사)이름</h3>
                        <p>호텔본사 : <span th:text="${hotelDTO.companyName}">본사명</span></p>
                        <p>호텔주소 : <span th:text="${hotelDTO.hotelAddress}">주소</span></p>
                        <p>상세정보 : <span th:text="${hotelDTO.hotelInfo}">상세정보</span></p>
                        <p>전화번호 : <span th:text="${hotelDTO.hotelPhone}">전화번호</span></p>
                        <p>이메일 : <span th:text="${hotelDTO.hotelEmail}">이메일</span></p>
                        <p>체크인 : <span th:text="${hotelDTO.hotelCheckIn}">체크인</span>시</p>
                        <p>체크아웃 : <span th:text="${hotelDTO.hotelCheckOut}">체크아웃</span>시</p>-->



                        <div class="container">

                            <!-- Room List Section -->
                            <section class="py-5">
                                <div class="container">
                                    <h4 class="mb-5">객실 선택</h4>

                                    <th:block th:if="${rooms == null || #lists.isEmpty(rooms)}">
                                        <div style="text-align: center">
                                            <img src="/img/empty.png" alt="No likes available" width="400px">
                                            <p>목록이 비어있습니다!</p>
                                        </div>
                                    </th:block>

                                    <th:block th:unless="${rooms == null || #lists.isEmpty(rooms)}">
                                        <div id="room-list" class="row">
                                            <div class="col-md-4" th:each="room : ${rooms}">
                                                <div class="room-card"
                                                     th:data-room-id="${room.roomId}"
                                                     th:data-stay-start="${room.stayStart}"
                                                     th:data-stay-end="${room.stayEnd}">
                                                    <!-- 수정된 부분: sold-out-overlay 추가 -->
                                                    <div class="room-image">
                                                        <img th:if="${!#lists.isEmpty(room.roomImageDTOList)}"
                                                             th:src="@{'/upload/' + ${room.roomImageDTOList[0].imagePath}}"
                                                             class="card-img-top"
                                                             th:alt="${room.roomName}" width="100%">
                                                        <img th:if="${#lists.isEmpty(room.roomImageDTOList)}"
                                                             src="/img/default_img.jpg"
                                                             class="card-img-top"
                                                             alt="Default Room Image" width="100%">
                                                        <!-- 예약 종료-->
                                                        <div class="sold-out-overlay" th:if="${!room.roomStatus}">
                                                            예약 종료
                                                        </div>
                                                    </div>
                                                    <div class="room-text">
                                                        <div class="d-flex justify-content-start gap-2 mb-3">
                                                            <!-- 예약 가능 여부 -->
                                                            <span th:text="(${room.roomStatus} ? '예약 가능' : '예약 불가')"
                                                                  class="badge"
                                                                  th:classappend="${room.roomStatus} ? 'bg-success text-white' : 'bg-danger text-white'">
                                </span>
                                                            <span th:text="${room.roomType}" class="badge bg-dark text-white"></span>
                                                        </div>
                                                        <h5 th:text="${room.roomName}" class="card-title"></h5>
                                                        <span>체크인 : <span th:text="${hotelDTO.hotelCheckIn}">체크인</span>시 - </span> <span>체크아웃 : <span th:text="${hotelDTO.hotelCheckOut}">체크아웃</span>시</span>
                                                        <div class="room-actions">
                                                            <p class="room-price mb-0"
                                                               th:text="${room.formattedRoomPrice != null ? room.formattedRoomPrice + ' ' + '~' : '가격 미정'}"></p>
                                                            <button class="btn btn-book" style="width: 100px"
                                                                    th:text="${room.roomStatus ? '예약하기' : '예약 불가'}"
                                                                    th:classappend="${room.roomStatus ? 'btn-dark' : 'btn-danger text-bold'}"
                                                                    th:disabled="${!room.roomStatus}">
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                    </th:block>

                                    <!-- 버튼 -->
                                    <div class="text-end mt-3">
                                        <a class="btn btn-primary" style="background-color: black" href="/hotel/list">목록</a>
                                    </div>
                                </div>
                            </section>

                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

    <!-- 예약 모달 -->
<!--    <div class="modal fade" id="reservationModal" tabindex="-1" aria-labelledby="reservationModalLabel" aria-hidden="true">-->
<!--        <div class="modal-dialog">-->
<!--            <div class="modal-content">-->
<!--                <div class="modal-header">-->
<!--                    <h5 class="modal-title" id="reservationModalLabel">호텔 예약하기</h5>-->
<!--                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>-->
<!--                </div>-->
<!--                <div class="modal-body">-->
<!--                    <form id="reservationForm">-->
<!--                        <input type="hidden" id="roomId" name="roomId">-->
<!--                        <div class="mb-3">-->
<!--                            <label for="checkInDate" class="form-label">체크인 날짜</label>-->
<!--                            <input type="date" class="form-control" id="checkInDate" name="checkInDate" required>-->
<!--                        </div>-->
<!--                        <div class="mb-3">-->
<!--                            <label for="checkOutDate" class="form-label">체크아웃 날짜</label>-->
<!--                            <input type="date" class="form-control" id="checkOutDate" name="checkOutDate" required>-->
<!--                        </div>-->
<!--                        <div class="mb-3">-->
<!--                            <label for="totalPrice" class="form-label">총 금액</label>-->
<!--                            <input type="text" class="form-control" id="totalPrice" name="totalPrice" readonly>-->
<!--                        </div>-->
<!--                    </form>-->
<!--                </div>-->
<!--                <div class="modal-footer">-->
<!--                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>-->
<!--                    <button type="button" id="confirmReservation" class="btn btn-primary">예약하기</button>-->
<!--                </div>-->
<!--            </div>-->
<!--        </div>-->
<!--    </div>-->


    <!-- JavaScript -->
    <script>
        // 예약 버튼 이벤트 추가 함수
        function addReservationButtonEvent(parentElement = document) {
            const reservationModal = new bootstrap.Modal(document.getElementById('reservationModal'));

            parentElement.querySelectorAll('.btn-book').forEach(button => {
                button.addEventListener('click', (e) => {
                    // 예약 가능 여부 확인
                    if (button.disabled) {
                        alert('이 방은 현재 예약이 불가능합니다.');
                        return;
                    }

                    const roomCard = e.target.closest('.room-card');
                    const roomId = roomCard.dataset.roomId; // roomId 가져오기
                    const roomPrice = roomCard.querySelector('.room-price').innerText; // 가격 가져오기
                    const stayStart = roomCard.dataset.stayStart; // 숙박 시작 날짜
                    const stayEnd = roomCard.dataset.stayEnd;   // 숙박 종료 날짜

                    // 모달 데이터 설정
                    document.getElementById('roomId').value = roomId; // 모달 폼에 roomId 설정
                    document.getElementById('totalPrice').value = roomPrice; // 모달 폼에 가격 설정

                    // 체크인, 체크아웃 날짜 제한 설정
                    const checkInInput = document.getElementById('checkInDate');
                    const checkOutInput = document.getElementById('checkOutDate');

                    checkInInput.min = stayStart; // 체크인 최소값 설정
                    checkInInput.max = stayEnd;   // 체크인 최대값 설정
                    checkOutInput.min = stayStart; // 체크아웃 최소값 설정
                    checkOutInput.max = stayEnd;   // 체크아웃 최대값 설정

                    checkInInput.addEventListener('change', () => {
                        checkOutInput.min = checkInInput.value; // 체크아웃 최소값은 체크인 날짜 이후
                    });

                    reservationModal.show(); // 모달 열기
                });
            });
        }

        // 예약 상태 업데이트 함수
        function updateRoomReservationStatus(parentElement = document) {
            const today = new Date();

            parentElement.querySelectorAll('.room-card').forEach(roomCard => {
                const stayEnd = roomCard.dataset.stayEnd;

                // stayEnd 값이 유효한지 확인
                if (!stayEnd) {
                    console.warn(`Invalid stayEnd for roomCard:`, roomCard);
                    return;
                }

                const reservationEndDate = new Date(stayEnd);

                // 예약기간이 지난 경우에만 표시
                if (reservationEndDate < today) {
                    const overlay = roomCard.querySelector('.sold-out-overlay');
                    if (overlay) {
                        overlay.style.display = 'flex'; // 오버레이 표시
                    }

                    // 예약 불가 버튼 처리
                    const button = roomCard.querySelector('.btn-book');
                    button.textContent = '예약 불가';
                    button.disabled = true;
                    button.classList.remove('btn-dark');
                    button.classList.add('btn-danger', 'text-bold');
                }
            });
        }

        // 모달 닫힐 때 강제 초기화
        document.getElementById('reservationModal').addEventListener('hidden.bs.modal', function () {
            const backdrop = document.querySelector('.modal-backdrop');
            if (backdrop) {
                backdrop.remove();
            }
            document.body.classList.remove('modal-open');
            document.body.style.removeProperty('overflow');
            document.body.style.removeProperty('padding-right');
        });

        // 페이지 로드 시 예약 버튼 이벤트 및 상태 업데이트 실행
        document.addEventListener('DOMContentLoaded', () => {
            addReservationButtonEvent();
            updateRoomReservationStatus(); // 초기 로드된 방들 상태 업데이트
        });

        // 'More' 버튼과 현재 페이지 변수
        const moreButton = document.getElementById('more-btn');
        let currentPage = 0;

        // 'More' 버튼 클릭 이벤트 리스너 추가
        moreButton.addEventListener('click', function () {
            currentPage++;
            // 서버로 AJAX 요청
            fetch(`/roomList/data?page=${currentPage}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('Fetched data:', data); // 받아온 데이터를 확인

                    const roomList = document.getElementById('room-list');

                    data.rooms.forEach(room => {
                        if (document.querySelector(`.room-card[data-room-id="${room.roomId}"]`)) {
                            console.warn(`Room with ID ${room.roomId} is already added. Skipping.`);
                            return;
                        }

                        const roomCard = `
                <div class="col-md-4">
                    <div class="room-card" data-room-id="${room.roomId}" data-stay-start="${room.stayStart}" data-stay-end="${room.stayEnd}">
                        <div class="room-image">
                            <img src="${room.roomImageDTOList.length > 0 ? '/upload/' + room.roomImageDTOList[0].imagePath : '/img/default_img.jpg'}" class="card-img-top" alt="Room Image">
                            <div class="sold-out-overlay" style="display: ${room.roomStatus ? 'none' : 'flex'}">
                                예약 종료
                            </div>
                        </div>
                        <div class="room-text">
                            <div class="d-flex justify-content-start gap-2 mb-3">
                                <span class="badge ${room.roomStatus ? 'bg-success text-white' : 'bg-danger text-white'}">
                                    ${room.roomStatus ? '예약 가능' : '예약 불가'}
                                </span>
                                <span class="badge bg-dark text-white">${room.roomType}</span>
                            </div>
                            <h5 class="card-title">${room.roomName}</h5>
                            <p class="card-text">예약 기간 : ${room.reservationStart} ~ ${room.reservationEnd}</p>
                            <p class="card-text">숙박 기간 : ${room.stayStart} ~ ${room.stayEnd}</p>
                            <div class="room-actions">
                                <p class="room-price mb-0">${room.formattedRoomPrice ? room.formattedRoomPrice +  ' ' + '~' : '가격 미정'}</p>
                                <button class="btn btn-book ${room.roomStatus ? 'btn-dark' : 'btn-danger'}" ${!room.roomStatus ? 'disabled' : ''}>
                                    ${room.roomStatus ? '예약하기' : '예약 불가'}
                                </button>
                            </div>
                        </div>
                    </div>
                </div>`;
                        roomList.insertAdjacentHTML('beforeend', roomCard);
                    });

                    if (data.isLastPage) {
                        moreButton.style.display = 'none';
                    }

                    addReservationButtonEvent(roomList);
                })
                .catch(error => {
                    console.error('Error fetching more rooms:', error);
                    moreButton.textContent = 'Error';
                    moreButton.disabled = true;
                });
        });

        // 예약하기 버튼 클릭 이벤트
        document.getElementById('confirmReservation').addEventListener('click', () => {
            const form = document.getElementById('reservationForm');
            const formData = new FormData(form);

            fetch('/reservation', {
                method: 'POST',
                body: formData,
            })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert('예약이 완료되었습니다!');
                        const reservationModal = bootstrap.Modal.getInstance(document.getElementById('reservationModal'));
                        reservationModal.hide();
                    } else {
                        alert('예약에 실패했습니다. 다시 시도해주세요.');
                    }
                })
                .catch(error => console.error('Error:', error));
        });
    </script>





</div>
<div th:replace="~{fragments/footer::footer}"></div>
</body>
</html>
