<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>
    <meta charset="UTF-8">
    <title>ì¦ê²¨ì°¾ê¸°</title>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <link rel ="stylesheet" href="/assets/css/bootstrap.min.css">
    <link rel ="stylesheet" href="/assets/bootstrap/css/bootstrap.min.css">

    <!-- ë¶€íŠ¸ìŠ¤íŠ¸ë© ì•„ì´ì½˜ -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.1/font/bootstrap-icons.css">

    <!-- FontAwesome -->
    <script src="https://kit.fontawesome.com/b17b1596b8.js" crossorigin="anonymous"></script>
    <link rel ="stylesheet" href="/assets/fonts/fontawesome-all.min.css">


    <link rel="stylesheet" th:href="@{/css/user.css}">
    <link rel="stylesheet" th:href="@{/css/roomList.css}">
    <link rel="stylesheet" th:href="@{/css/pagination.css}">


    <style>

        html, body {
            height: 100%;
            margin: 0;
        }

        .wrapper {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .content {
            flex: 1;
        }

        .image-box {
            width:100%;
            height:230px;
            overflow:hidden;
            margin:0 auto;
        }

        .hotelImg {
            width:100%;
            height:100%;
            object-fit:cover;
        }
    </style>

    <!-- JavaScript inline -->
    <script th:inline="javascript">

        $(document).ready(function () {

            // ì„¸ì…˜ì—ì„œ message ê°’ì„ ê°€ì ¸ì˜´
            var message = [[${message}]];

            // messageê°€ nullì´ ì•„ë‹ˆë©´ ì•Œë¦¼ì°½ì„ ë„ìš°ê³  ì„¸ì…˜ì—ì„œ ì‚­ì œ
            if (message !== null && message !== '') {
                alert(message);
            }



            $(".delBtn").on("click", function () {
                var likeHotelId = $(this).data("hotel-id"); // ë²„íŠ¼ì— ì €ì¥ëœ likeHotelId ê°€ì ¸ì˜¤ê¸°

                console.log(likeHotelId)


                if (!likeHotelId) {
                    alert("í˜¸í…” IDë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                    return;
                }

                // ì°œ ì—¬ë¶€ í™•ì¸ í›„ ë²„íŠ¼ ìƒíƒœ ë³€ê²½
                $(".room-card").each(function () {
                    var hotelId = $(this).find(".hotelId").val();

                    $.ajax({
                        url: "/like/check/" + hotelId,
                        type: "GET",
                        success: function (isLiked) {

                            var delBtn = $(".delBtn[data-hotel-id='" + hotelId + "']");

                            if (isLiked) {
                                delBtn.show();
                            } else {
                                delBtn.hide();
                            }
                        },
                        error: function () {
                            console.error("ì°œ ì—¬ë¶€ í™•ì¸ ì‹¤íŒ¨ (í˜¸í…” ID: " + hotelId + ")");
                        }
                    });
                });


                $.ajax({
                    url: "/like/deleteList",
                    type: "POST",
                    contentType: "application/json; charset=utf-8",
                    data: JSON.stringify({ likeHotelId: likeHotelId }),  // ë³€ê²½ëœ ë¶€ë¶„
                    success: function () {
                        alert("ì¦ê²¨ì°¾ê¸°ì—ì„œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
                        location.reload(); // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
                    },
                    error: function (xhr) {
                        console.error("ì‚­ì œ ì‹¤íŒ¨:", xhr.responseText);
                        alert("ì‚­ì œ ì‹¤íŒ¨: " + xhr.responseText);
                    }
                });
            });

        });

    </script>


</head>
<body>
<div th:replace="~{fragments/header::header}"></div>

<div layout:fragment="content">
    <!-- ë°°ë„ˆ ì´ë¯¸ì§€ -->
    <section class="banner-container room-bnr ">
        <img src="/img/bg_membership.jpg" alt="Hotel Banner">
    </section>

    <!-- Room List Section -->
    <section class="py-5">
        <div class="container">
            <h1 class="text-center mb-5 mt-2">ìŠ¤í¬ë©í•œ í˜¸í…”</h1>
            <div id="room-list" class="row">

                <th:block th:if="${likeDTO == null || #lists.isEmpty(likeDTO)}">
                    <div class="mb-5 mt-5" style="text-align: center">
                        <h3>ìŠ¤í¬ë©í•œ í˜¸í…”ì´ ì—†ìŠµë‹ˆë‹¤ğŸ§</h3>
                        <p>ê´€ì‹¬ìˆëŠ” í˜¸í…”ì„ ìŠ¤í¬ë©í•˜ì—¬ í¸í•˜ê²Œ ëª¨ì•„ë³´ì„¸ìš”!</p>
                        <div class="mb-5">
                            <a href="/hotel/list" class="btn btn-lg btn-outline-dark">í˜¸í…”ë³´ëŸ¬ê°€ê¸°</a>
                        </div>
                    </div>
                </th:block>

                <th:block th:unless="${likeDTO == null}">
                    <!--ë°˜ë³µë¬¸-->
                    <th:block th:each="data : ${likeDTO}">
                        <!-- Room Card -->
                        <div class="col-md-4">
                            <a th:href="@{/hotel/read(hotelId=${data.hotelDTO.hotelId})}">

                                <div class="room-card ">
                                    <div class="room-image">
                                        <!--ë“±ë¡í•œ ì‚¬ì§„ì´ ìˆì„ ë•Œ-->
                                        <th:block th:if="${data.hotelDTO.hotelImgDTOList != 0}">
                                            <div class="room-image image-box" th:each="data: ${data.hotelDTO.hotelImgDTOList}">
                                                <!-- ì´ë¯¸ì§€ ê²½ë¡œ(path) -->
                                                <img th:src="@{'/upload/' + ${data.imagePath}}" class="hotelImg" alt="hotel Image" width="100%"/>
                                            </div>
                                        </th:block>
                                        <!--ë“±ë¡í•œ ì‚¬ì§„ì´ ì—†ì„ ë•Œ-->
                                        <th:block th:unless="${data.hotelDTO.hotelImgDTOList.size() != 0}">
                                            <div class="room-image image-box">
                                                <img src="/img/default_img.jpg" alt="noImage" class="hotelImg" style="width: 300px"/>
                                            </div>
                                        </th:block>

                                        <div class="hover-overlay">
                                            <a th:href="@{/hotel/read(hotelId=${data.hotelDTO.hotelId})}" class="btn btn-hover">ìì„¸íˆ ë³´ê¸°</a>
                                        </div>
                                    </div>
                                    <div class="room-text">
                                        <div class="d-flex justify-content-start gap-2 mb-2">
                                            <!-- ì§€ì—­ë²„íŠ¼ -->
                                            <div style="display: flex; gap: 5px;">
                                                <a th:href="@{'/hotel/list?searchType=location&keyword=' + ${data.hotelDTO.hotelLocation}}" style="text-decoration: none">
                                                    <div class="badge bg-secondary" th:text="${data.hotelDTO.hotelLocation}">ì§€ì—­</div>
                                                </a>
                                            </div>
                                        </div>
                                        <h4 th:text="${data.hotelDTO.hotelName}" class="card-title mb-2">í˜¸í…” ì´ë¦„</h4>
                                        <p th:text="'ì²´í¬ì¸-ì²´í¬ì•„ì›ƒ: ' + ${data.hotelDTO.hotelCheckIn} + 'ì‹œ ~ ' + ${data.hotelDTO.hotelCheckOut} + 'ì‹œ'" class="card-text"></p>
                                        <input type="hidden" class="hotelId" th:value="${data.likeHotelId}">
                                        <div class="room-actions" style="margin-top: -5px">
                                            <p class="room-price mb-0"
                                               th:text="${data.hotelDTO.CheapestRoomPrice != null ? data.hotelDTO.CheapestRoomPrice + ' KRW' + '~' : 'ê°€ê²© ë¯¸ì •'}"></p>
                                            <div class="room-buttons">
                                                <button class="btn btn-outline-danger delBtn"  th:data-hotel-id="${data.likeHotelId}" style="width: 50px; height: 50px">
                                                    <i class="bi bi-heart-fill" style="margin: auto; text-align: center"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </a>
                        </div>
                    </th:block>

                </th:block>

                <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
                <div class="d-flex justify-content-center">
                    <ul class="pagination">
                        <!-- ì²˜ìŒ í˜ì´ì§€ -->
                        <li class="page-item" th:if="${currentPage > 0}">
                            <a class="page-link" th:href="@{/like/list(page=0)}">ì²˜ìŒ</a>
                        </li>

                        <!-- ì´ì „ í˜ì´ì§€ -->
                        <li class="page-item" th:if="${currentPage > 0}">
                            <a class="page-link" th:href="@{/like/list(page=${currentPage - 1})}">ì´ì „</a>
                        </li>

                        <!-- í˜ì´ì§€ ë²ˆí˜¸ -->
                        <th:block th:if="${totalPages > 0}">
                            <th:block th:each="page : ${#numbers.sequence(0, totalPages - 1)}">
                                <li class="page-item" th:classappend="${currentPage == page} ? 'active'">
                                    <a class="page-link" th:href="@{/like/list(page=${page})}" th:text="${page + 1}"></a>
                                </li>
                            </th:block>
                        </th:block>


                        <!-- ë‹¤ìŒ í˜ì´ì§€ -->
                        <li class="page-item" th:if="${currentPage < totalPages - 1}">
                            <a class="page-link" th:href="@{/like/list(page=${currentPage + 1})}">ë‹¤ìŒ</a>
                        </li>

                        <!-- ë§ˆì§€ë§‰ í˜ì´ì§€ -->
                        <li class="page-item" th:if="${currentPage < totalPages - 1}">
                            <a class="page-link" th:href="@{/like/list(page=${totalPages - 1})}">ë</a>
                        </li>
                    </ul>
                </div>


            </div>
        </div>
    </section>

</div>

<div th:replace="~{fragments/footer::footer}"></div>
</body>
</html>
