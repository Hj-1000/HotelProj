<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
>
<head>
    <meta charset="UTF-8">
    <title>NTT호텔 - 관리자 회원가입</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" th:href="@{/css/user.css}">
    <style>
        /* 회원가입 화면 스타일 */
        .register-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 20px;
            margin-bottom: 20px;
            min-height: calc(100vh - 249px); /* 100vh = 화면 전체 높이를 차지하도록 (-209px 는 헤더와 푸터의 높이) */
        }

        .register-card {
            width: 100%;
            max-width: 420px; /* 카드 너비 */
            padding: 20px;
            border-radius: 10px; /* 모서리 둥글게 */
            border: 1px solid #ddd; /* 테두리 색상 */
            box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1); /* 그림자 추가 */
        }

    </style>
</head>
<body>
<div th:replace="~{fragments/header::header}"></div>
<!--본문-->
<div layout:fragment="content" class="register-container">
    <div class="card register-card">
        <h5 class="card-title text-center mb-4 fw-bold">관리자 회원가입</h5>
        <form action="/admin/register" method="post" onsubmit="return registerCheck();">
            <div class="mb-3 mt-3">
                <label for="memberName" class="form-label fw-bold">*관리자 이름 :</label>
                <input type="text" class="form-control" id="memberName" name="memberName" required>
            </div>
            <div class="mb-3">
                <label for="memberEmailInput" class="form-label fw-bold">*이메일 :</label>
                <input type="email" class="form-control" id="memberEmailInput" name="memberEmail" placeholder="이메일 형식에 맞춰서 작성해주세요." required>
                <small id="emailCheckMessage" style="display: none;"></small>
            </div>
            <div class="mb-3">
                <label for="memberPassword" class="form-label fw-bold">*비밀번호 :</label>
                <input type="password" class="form-control" id="memberPassword" name="memberPassword" placeholder="비밀번호는 6~12자 이내로 입력해주세요." required>
                <small id="passwordMessage" style="display: none;"></small>
            </div>
            <div class="mb-3">
                <label for="memberPasswordCheck" class="form-label fw-bold">*비밀번호 확인 :</label>
                <input type="password" class="form-control" id="memberPasswordCheck" name="memberPasswordCheck" placeholder="비밀번호를 한번 더 입력해주세요." required>
                <small id="passwordCheckMessage" style="display: none;"></small>
            </div>
            <div class="mb-3">
                <label for="memberPhone" class="form-label fw-bold">전화번호 :</label>
                <input type="tel" pattern="[0-9]*" class="form-control" id="memberPhone" name="memberPhone" placeholder="'-' 없이 숫자만 입력해주세요.">
                <small id="phoneCheckMessage" style="display: none;"></small>
            </div>
            <div class="mb-3">
                <label for="code" class="form-label fw-bold">*인증코드 :</label>
                <input type="text" class="form-control" id="code" name="code" placeholder="나는어드민 = ADMIN / 나는호텔장 = CHIEF" required>
                <small id="codeCheckMessage" style="display: none;"></small>
            </div>
            <div>
                <select id="role" name="role" class="form-select" hidden="hidden">
                    <option value="ADMIN">어드민</option>
                    <option value="CHIEF">호텔장</option>
                    <option value="MANAGER">매니저</option>
                    <option value="USER">유저</option>
                </select>
            </div>
            <p>* 표시는 필수 입력 항목입니다.</p>
            <button type="submit" class="btn btn-primary">회원가입</button>
            <button type="button" class="btn btn-danger" onclick="location.href='/'">취소</button>
        </form>

        <script type="text/javascript">

            // 이메일 체크
            function emailCheck() {
                var email = document.getElementById('memberEmailInput').value;
                var messageElement = document.getElementById('emailCheckMessage');
                var emailPattern = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9]+\.[a-zA-Z0-9]{1,}$/;

                if (!email) {
                    messageElement.style.display = "block";
                    messageElement.style.color = "red";
                    messageElement.innerText = "이메일을 입력하세요.";
                    return;
                }

                if (!emailPattern.test(email)) {
                    messageElement.style.display = "block";
                    messageElement.style.color = "red";
                    messageElement.innerText = "이메일 형식에 맞춰서 작성해주세요.";
                    return;
                }

                fetch('/checkEmail?email=' + encodeURIComponent(email), {
                    method: 'GET',
                })
                    .then(response => response.json())
                    .then(data => {
                        messageElement.style.display = "block";
                        if (data.exists) {
                            messageElement.style.color = "red";
                            messageElement.innerText = "이미 사용 중인 이메일입니다.";
                        } else {
                            messageElement.style.color = "green";
                            messageElement.innerText = "사용 가능한 이메일입니다.";
                        }
                    })
                    .catch(error => {
                        console.error("에러 발생:", error);
                        messageElement.style.display = "block";
                        messageElement.style.color = "red";
                        messageElement.innerText = "중복 확인 중 오류가 발생했습니다.";
                    });
            }

            // 비밀번호 및 비밀번호 확인 체크
            function passwordCheck() {
                var p1 = document.getElementById('memberPassword').value;
                var p2 = document.getElementById('memberPasswordCheck').value;
                var passwordMessage = document.getElementById('passwordMessage');
                var passwordCheckMessage = document.getElementById('passwordCheckMessage');

                if(p1.length === 0) {
                    passwordMessage.style.display = "none";
                } else if (p1.length < 6) {
                    passwordMessage.style.display = "block";
                    passwordMessage.style.color = "red";
                    passwordMessage.innerText = "비밀번호는 6글자 이상이어야 합니다.";
                } else if (p1.length > 12) {
                    passwordMessage.style.display = "block";
                    passwordMessage.style.color = "red";
                    passwordMessage.innerText = "비밀번호는 12글자 이내여야 합니다.";
                } else {
                    passwordMessage.style.display = "block";
                    passwordMessage.style.color = "green";
                    passwordMessage.innerText = "사용 가능한 비밀번호입니다.";
                }

                if(p2.length === 0) {
                    passwordCheckMessage.style.display = "none";
                } else if (p2.length < 6) {
                    passwordCheckMessage.style.display = "block";
                    passwordCheckMessage.style.color = "red";
                    passwordCheckMessage.innerText = "비밀번호를 확인해주세요.";
                } else if (p2.length > 12) {
                    passwordCheckMessage.style.display = "block";
                    passwordCheckMessage.style.color = "red";
                    passwordCheckMessage.innerText = "비밀번호를 확인해주세요.";
                } else if (p1 !== p2) {
                    passwordCheckMessage.style.display = "block";
                    passwordCheckMessage.style.color = "red";
                    passwordCheckMessage.innerText = "비밀번호가 일치하지 않습니다.";
                } else {
                    passwordCheckMessage.style.display = "block";
                    passwordCheckMessage.style.color = "green";
                    passwordCheckMessage.innerText = "비밀번호가 일치합니다.";
                }
            }

            // 전화번호 체크
            function phoneCheck() {
                var phone = document.getElementById('memberPhone').value;
                var phoneCheckMessage = document.getElementById('phoneCheckMessage');
                if(phone.length === 0) {
                    phoneCheckMessage.style.display = "none";
                } else if (phone.length !== 11) {
                    phoneCheckMessage.style.display = "block";
                    phoneCheckMessage.style.color = "red";
                    phoneCheckMessage.innerText = "전화번호는 11자리여야 합니다.";
                } else {
                    phoneCheckMessage.innerText = "";
                    phoneCheckMessage.style.display = "none";
                }
            }

            // 인증코드 체크
            function codeCheck() {
                var code = document.getElementById('code').value;
                var codeCheckMessage = document.getElementById('codeCheckMessage');
                var roleSelect = document.getElementById('role');

                if (code === "나는어드민") {
                    codeCheckMessage.innerText = "";
                    roleSelect.value = "ADMIN";  // 어드민 자동 선택
                } else if (code === "나는호텔장") {
                    codeCheckMessage.innerText = "";
                    roleSelect.value = "CHIEF";  // 호텔장 자동 선택
                } else if (code === "나는매니저") {
                    codeCheckMessage.innerText = "";
                    roleSelect.value = "MANAGER";  // 호텔장 자동 선택
                } else if (code === "나는유저") {
                    codeCheckMessage.innerText = "";
                    roleSelect.value = "USER";  // 호텔장 자동 선택
                } else {
                    codeCheckMessage.style.display = "block";
                    codeCheckMessage.style.color = "red";
                    codeCheckMessage.innerText = "인증코드가 유효하지 않습니다.";
                }
            }

            // 자동 체크 이벤트 리스너 추가
            document.getElementById('memberEmailInput').addEventListener("input", emailCheck);
            document.getElementById('memberPassword').addEventListener("input", passwordCheck);
            document.getElementById('memberPasswordCheck').addEventListener("input", passwordCheck);
            document.getElementById('memberPhone').addEventListener("input", phoneCheck);
            document.getElementById('memberPhone').addEventListener("input", function(event) {
                // 전화번호 입력 시 숫자만 허용
                this.value = this.value.replace(/[^0-9]/g, "");
            });
            document.getElementById('code').addEventListener("input", codeCheck);

            // 회원가입 폼 제출 전 알림창
            function registerCheck() {
                var emailCheckMessage = document.getElementById('emailCheckMessage').innerText;
                var passwordMessage = document.getElementById('passwordMessage').innerText;
                var passwordCheckMessage = document.getElementById('passwordCheckMessage').innerText;
                var phoneCheckMessage = document.getElementById('phoneCheckMessage').innerText;
                var codeCheckMessage = document.getElementById('codeCheckMessage').innerText;

                if (emailCheckMessage === "이미 사용 중인 이메일입니다." || emailCheckMessage === "이메일 형식에 맞춰서 작성해주세요." || emailCheckMessage === "이메일을 입력하세요.") {
                    alert("이메일을 확인해주세요.");
                    return false;
                }
                if (passwordMessage === "비밀번호는 6글자 이상이어야 합니다." || passwordMessage === "비밀번호는 12글자 이내여야 합니다.") {
                    alert("비밀번호를 확인해주세요.");
                    return false;
                }
                if (passwordCheckMessage === "비밀번호가 일치하지 않습니다.") {
                    alert("비밀번호를 확인해주세요.");
                    return false;
                }
                if (passwordCheckMessage === "비밀번호를 확인해주세요.") {
                    alert("비밀번호를 확인해주세요.");
                    return false;
                }
                if (document.getElementById('memberPhone').value && phoneCheckMessage === "전화번호는 11자리여야 합니다.") {
                    alert("전화번호를 확인해주세요.");
                    return false;
                }
                if (codeCheckMessage === "인증코드가 유효하지 않습니다.") {
                    alert("인증코드를 확인해주세요.");
                    return false;
                }
                alert("회원가입에 성공하였습니다. 로그인 페이지로 이동합니다.");
                return true;
            }
        </script>
    </div>
</div>
<div th:replace="~{fragments/footer::footer}"></div>
</body>
</html>