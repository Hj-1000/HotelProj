<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/layout}">
<head>
    <meta charset="UTF-8">
    <title>NTTí˜¸í…” - ë§¤ë‹ˆì € ë“±ë¡</title>
    <style>
        .custom-link {
            color: black;
            text-decoration: none;
            margin-bottom: 10px;
            display: inline-block;
        }
        .custom-link:hover {
            color: gray; /* ë§ˆìš°ìŠ¤ ì˜¬ë¦¬ë©´ íšŒìƒ‰ */
        }
    </style>
</head>
<body>
    <div id="wrapper" layout:fragment="content">
        <div class="container-fluid mt-4">
            <a href="/" class="custom-link"><span>ğŸšHOME</span></a> /
            <a href="/admin/memberList" class="custom-link"><span>íšŒì›ê´€ë¦¬</span></a> /
            <a href="/admin/executiveList" class="custom-link"><span>ì„ì›ê´€ë¦¬</span></a> /
            <a href="/admin/executiveRegister" class="custom-link"><span>ë§¤ë‹ˆì € ë“±ë¡</span></a>
            <h2 class="mb-3">ë§¤ë‹ˆì € ë“±ë¡</h2>
            <div class="card p-4">
                <h5 class="mb-3">ë§¤ë‹ˆì € ì •ë³´ ë“±ë¡</h5>
                <form action="/admin/executiveRegister" method="post" onsubmit="return registerCheck();">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label for="memberName" class="form-label fw-bold">*ì´ë¦„</label>
                            <input type="text" class="form-control" id="memberName" name="memberName" placeholder="ì´ë¦„" required>
                        </div>
                        <div class="col-md-6">
                            <label for="memberEmailInput" class="form-label fw-bold">*ì´ë©”ì¼ :</label>
                            <div class="input-group">
                                <input type="email" class="form-control" id="memberEmailInput" name="memberEmail" required>
                                <button type="button" class="btn btn-secondary" onclick="emailCheck()">ì¤‘ë³µí™•ì¸</button>
                            </div>
                            <small id="emailCheckMessage" style="display: none;"></small>
                        </div>
                        <div class="col-md-6">
                            <label for="memberPassword" class="form-label fw-bold">*ë¹„ë°€ë²ˆí˜¸</label>
                            <input type="password" class="form-control" id="memberPassword" name="memberPassword" placeholder="ë¹„ë°€ë²ˆí˜¸ëŠ” 6~12ìì˜ ì˜ë¬¸, ìˆ«ì, ê¸°í˜¸" required>
                        </div>
                        <div class="col-md-6">
                            <label for="memberPasswordCheck" class="form-label fw-bold">*ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
                            <input type="password" class="form-control" id="memberPasswordCheck" name="memberPasswordCheck" placeholder="ë¹„ë°€ë²ˆí˜¸ëŠ” 6~12ìì˜ ì˜ë¬¸, ìˆ«ì, ê¸°í˜¸" required>
                        </div>
                        <div class="col-md-6">
                            <label for="company" class="form-label fw-bold">*ë³¸ì‚¬</label>
                            <select class="form-select" id="company" name="company">
                                <option th:unless="${#lists.isEmpty(companyList)}" value="">ë³¸ì‚¬ ì„ íƒ</option>
                                <option th:if="${#lists.isEmpty(companyList)}" value="">ë¨¼ì € ë³¸ì‚¬ì™€ ì§€ì‚¬ë¥¼ ë“±ë¡í•´ ì£¼ì„¸ìš”</option>
                                <option th:each="company : ${companyList}" th:value="${company.companyId}" th:text="${company.companyName}"></option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="hotelSelect" class="form-label fw-bold">*ì§€ì‚¬</label>
                            <select id="hotelSelect" class="form-select" name="hotelId" required>
                                <option value="">ë¨¼ì € ë³¸ì‚¬ë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”</option>
                            </select>
                        </div>
                        <div class="col-md-12">
                            <label for="memberPhone" class="form-label fw-bold">ì „í™”ë²ˆí˜¸</label>
                            <input type="text" class="form-control" id="memberPhone" name="memberPhone" placeholder="ì—°ë½ì²˜">
                        </div>
                    </div>
                    <div class="text-end mt-4">
                        <p>* í‘œì‹œëŠ” í•„ìˆ˜ ì…ë ¥ í•­ëª©ì…ë‹ˆë‹¤.</p>
                        <button type="submit" class="btn btn-primary me-2" style="background-color: black">ë“±ë¡</button>
                        <button type="reset" class="btn btn-secondary" onclick="location.href='/admin/executiveList'">ì·¨ì†Œ</button>
                    </div>
                </form>
                <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
                <script type="text/javascript">
                    $(document).ready(function() {
                        // #company ì„ íƒ ì‹œ ì‹¤í–‰
                        $("#company").change(function() {
                            var companyId = $(this).val(); // ì„ íƒí•œ ë³¸ì‚¬ì˜ ID ê°€ì ¸ì˜¤ê¸°

                            // íšŒì‚¬ IDê°€ ì„ íƒë˜ì§€ ì•Šìœ¼ë©´ ì§€ì‚¬ ëª©ë¡ ì´ˆê¸°í™”
                            if (!companyId) {
                                $("#hotelSelect").empty();  // ê¸°ì¡´ ì˜µì…˜ ì œê±°
                                $("#hotelSelect").append('<option value="">ë¨¼ì € ë³¸ì‚¬ë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”</option>');
                                return;
                            }

                            $.ajax({
                                url: "/admin/hotels",  // ë³¸ì‚¬ì— í•´ë‹¹í•˜ëŠ” ì§€ì‚¬ë¥¼ ê°€ì ¸ì˜¤ëŠ” API
                                type: "GET",
                                data: { companyId: companyId },  // ì„ íƒí•œ íšŒì‚¬ ID ì „ì†¡
                                success: function(hotels) {
                                    var hotelSelect = $("#hotelSelect");
                                    hotelSelect.empty();  // ê¸°ì¡´ ì˜µì…˜ ì œê±°

                                    if (hotels.length > 0) {
                                        // ì§€ì‚¬ ëª©ë¡ì´ ìˆì„ ê²½ìš°
                                        hotels.forEach(function(hotel) {
                                            hotelSelect.append(
                                                `<option value="${hotel.hotelId}">${hotel.hotelName}</option>`
                                            );
                                        });
                                    } else {
                                        // ì§€ì‚¬ ëª©ë¡ì´ ì—†ì„ ê²½ìš°
                                        hotelSelect.append('<option value="">ë¨¼ì € ì§€ì‚¬ë¥¼ ë“±ë¡í•´ ì£¼ì„¸ìš”</option>');
                                    }
                                },
                                error: function() {
                                    alert("ì§€ì‚¬ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
                                }
                            });
                        });
                    });

                    $(document).ready(function() {
                        $("#company").change(function() {
                            var companyId = $(this).val();
                            // ë©¤ë²„ IDë¥¼ hidden í•„ë“œì— ì„¤ì • (ì˜ˆ: ì„¸ì…˜ì—ì„œ ê°€ì ¸ì˜¤ê¸°)
                            var memberId = "ë©¤ë²„ì˜ ì‹¤ì œ ID"; // ì´ ê°’ì„ ì„œë²„ì—ì„œ ë°›ì•„ì˜¬ í•„ìš”ê°€ ìˆìŒ
                            $("#memberId").val(memberId);
                        });

                        // ì§€ì‚¬ ì„ íƒ í›„ ì„œë²„ë¡œ ë³´ë‚´ê¸°
                        $("form").submit(function() {
                            var hotelId = $("#hotelSelect").val();
                            var memberId = $("#memberId").val();
                            // ì„œë²„ë¡œ ë³´ë‚´ëŠ” ë¡œì§ ì¶”ê°€
                        });
                    });

                    // ì´ë©”ì¼ ì¤‘ë³µí™•ì¸
                    function emailCheck() {
                        var email = document.getElementById('memberEmailInput').value;
                        var messageElement = document.getElementById('emailCheckMessage');
                        // ì´ë©”ì¼ í˜•ì‹ ì²´í¬
                        var emailPattern = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9]+\.[a-zA-Z0-9]{1,}$/;

                        if (!email) {
                            messageElement.style.display = "block";
                            messageElement.style.color = "red";
                            messageElement.innerText = "ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”.";
                            return;
                        }

                        // ì´ë©”ì¼ í˜•ì‹ì´ ë§ì§€ ì•Šìœ¼ë©´ ë©”ì‹œì§€ í‘œì‹œ
                        if (!emailPattern.test(email)) {
                            messageElement.style.display = "block";
                            messageElement.style.color = "red";
                            messageElement.innerText = "ì´ë©”ì¼ í˜•ì‹ì— ë§ì¶° ì…ë ¥í•´ì£¼ì„¸ìš”.";
                            return;
                        }

                        fetch('/checkEmail?email=' + encodeURIComponent(email), {
                            method: 'GET',
                        })
                            .then(response => response.json())
                            .then(data => {
                                messageElement.style.display = "block";
                                if (data.exists) {
                                    messageElement.style.color = "red";
                                    messageElement.innerText = "ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ì´ë©”ì¼ì…ë‹ˆë‹¤.";
                                } else {
                                    messageElement.style.color = "green";
                                    messageElement.innerText = "ì‚¬ìš© ê°€ëŠ¥í•œ ì´ë©”ì¼ì…ë‹ˆë‹¤.";
                                }
                            })
                            .catch(error => {
                                console.error("ì—ëŸ¬ ë°œìƒ:", error);
                                messageElement.style.display = "block";
                                messageElement.style.color = "red";
                                messageElement.innerText = "ì¤‘ë³µ í™•ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
                            });
                    }

                    // ë¹„ë°€ë²ˆí˜¸ ë° ì¸ì¦ì½”ë“œ, ì´ë©”ì¼ ì²´í¬
                    function registerCheck() {
                        var email = document.getElementById('memberEmailInput').value;
                        var p1 = document.getElementById('memberPassword').value;
                        var p2 = document.getElementById('memberPasswordCheck').value;

                        // ë¹„ë°€ë²ˆí˜¸ ê¸¸ì´ ì²´í¬
                        if (p1.length < 6) {
                            alert('ë¹„ë°€ë²ˆí˜¸ëŠ” 6ê¸€ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.');
                            return false;
                        }

                        // ë¹„ë°€ë²ˆí˜¸ í™•ì¸
                        if (p1 != p2) {
                            alert("ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
                            return false;
                        } else {
                            fetch('/checkEmail?email=' + encodeURIComponent(email), {
                                method: 'GET',
                            })
                                .then(response => response.json())
                                .then(data => {
                                    if (data.exists) {
                                        // ì´ë©”ì¼ì´ ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ê²½ìš° alert ë„ìš°ê¸°
                                        alert("ì´ë¯¸ ê°€ì…ëœ íšŒì›ì…ë‹ˆë‹¤.");
                                        return false; // íšŒì›ê°€ì… ì œì¶œ ë§‰ê¸°
                                    }
                                    alert("íšŒì›ê°€ì…ì— ì„±ê³µí•˜ì˜€ìŠµë‹ˆë‹¤.");
                                })
                        }
                    }

                    // ì „í™”ë²ˆí˜¸ ì…ë ¥ ì‹œ ìˆ«ìë§Œ í—ˆìš©
                    document.getElementById("memberPhone").addEventListener("input", function (event) {
                        this.value = this.value.replace(/[^0-9]/g, "");
                    });
                </script>

            </div>
        </div>
    </div>
</body>
</html>