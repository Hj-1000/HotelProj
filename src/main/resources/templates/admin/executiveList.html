<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/layout}">
<head>
    <meta charset="UTF-8">
    <title>NTTí˜¸í…” - ì„ì›ê´€ë¦¬</title>
    <style>
        .custom-link {
            color: black;
            text-decoration: none;
            margin-bottom: 10px;
            display: inline-block;
        }
        .custom-link:hover {
            color: gray; /* ë§ˆìš°ìŠ¤ ì˜¬ë¦¬ë©´ íšŒìƒ‰ */
        }
    </style>
</head>
<body>
<div layout:fragment="content">
    <div class="container-fluid mt-4">
        <a href="/" class="custom-link"><span><i class="bi bi-house-fill"></i> HOME</span></a> /
        <a href="#" class="custom-link"><span>íšŒì›ê´€ë¦¬</span></a> /
        <a href="/admin/executiveList" class="custom-link"><span>ì„ì›ê´€ë¦¬</span></a>
        <h2 class="mb-3">ì„ì›ê´€ë¦¬</h2>
        <div class="card p-4">
            <form th:action="@{/admin/executiveList}" method="get">
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="role" class="form-label">ê¶Œí•œ</label>
                            <select class="form-select" id="role" name="role">
                                <option selected>ì „ì²´</option>
                                <option value="CHIEF">CHIEF</option>
                                <option value="MANAGER">MANAGER</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="email" class="form-label">ì´ë©”ì¼</label>
                            <input type="text" class="form-control" id="email" name="email" placeholder="ì´ë©”ì¼" th:value="${param.email}">
                        </div>
                        <div class="mb-3">
                            <label for="companyId" class="form-label">ë³¸ì‚¬</label>
                            <select class="form-select" id="companyId" name="companyId">
                                <option value="">ì „ì²´</option>
                                <option th:each="company : ${companyList}" th:value="${company.companyId}" th:text="${company.companyName}"></option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">ë“±ë¡ì¼</label>
                            <div class="d-flex gap-3">
                                <div class="form-group" style="flex: 1;">
                                    <input type="date" class="form-control" id="ì‹œì‘ì¼" name="startDate"th:value="${param.startDate}">
                                </div> ~
                                <div class="form-group" style="flex: 1;">
                                    <input type="date" class="form-control" id="ì¢…ë£Œì¼" name="endDate" th:value="${param.endDate}">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6">

                        <div class="mb-3">
                            <label for="name" class="form-label">ì´ë¦„</label>
                            <input type="text" class="form-control" id="name" name="name" placeholder="ì´ë¦„" th:value="${param.name}">
                        </div>
                        <div class="mb-3">
                            <label for="phone" class="form-label">ì—°ë½ì²˜</label>
                            <input type="text" class="form-control" id="phone" name="phone" placeholder="ì—°ë½ì²˜" th:value="${param.phone}">
                        </div>
                        <div class="mb-3">
                            <label for="hotelId" class="form-label">ì§€ì‚¬</label>
                            <select id="hotelId" class="form-select" name="hotelId" th:value="${param.hotelId}">
                                <option value="">ë¨¼ì € ë³¸ì‚¬ë¥¼ ì„ íƒí•˜ì„¸ìš”.</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">ìƒíƒœ</label>
                            <div class="d-flex flex-wrap gap-3">
                                <div class="form-check form-check-card px-0" style="margin-left: 30px; margin-top: 7px">
                                    <input class="form-check-input" type="radio" name="status" id="ìƒíƒœì „ì²´" value="ì „ì²´" checked>
                                    <label class="form-check-label" for="ìƒíƒœì „ì²´">ì „ì²´</label>
                                </div>
                                <div class="form-check form-check-card" style="margin-top: 7px">
                                    <input class="form-check-input" type="radio" name="status" id="ìƒíƒœí™œì„±" value="í™œì„±">
                                    <label class="form-check-label" for="ìƒíƒœí™œì„±">í™œì„±</label>
                                </div>
                                <div class="form-check form-check-card" style="margin-top: 7px">
                                    <input class="form-check-input" type="radio" name="status" id="ìƒíƒœë¹„í™œì„±" value="ë¹„í™œì„±">
                                    <label class="form-check-label" for="ìƒíƒœë¹„í™œì„±">ë¹„í™œì„±</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="text-center mt-3">
                    <button type="submit" class="btn btn-dark">
                        <i class="bi bi-search"></i> ì¡°íšŒ</button>
                </div>
            </form>
        </div>

        <div class="card mt-4">
            <div class="card-body">
                <h5 class="card-title">ì„ì› ëª©ë¡</h5>
                <table class="table table-bordered text-center">
                    <thead>
                    <tr>
                        <th style="background-color: #f8f9fa; width: 6%">íšŒì›ë²ˆí˜¸</th>
                        <th style="background-color: #f8f9fa; width: 10%">ì„ì›ê¶Œí•œ</th>
                        <th style="background-color: #f8f9fa; width: 15%">ì•„ì´ë””</th>
                        <th style="background-color: #f8f9fa; width: 9%">ì´ë¦„</th>
                        <th style="background-color: #f8f9fa; width: 10%">ì†Œì†ë³¸ì‚¬</th>
                        <th style="background-color: #f8f9fa; width: 10%">ë‹´ë‹¹ì§€ì‚¬</th>
                        <th style="background-color: #f8f9fa; width: 12%">ì—°ë½ì²˜</th>
                        <th style="background-color: #f8f9fa; width: 12%">ë“±ë¡ì¼</th>
                        <th style="background-color: #f8f9fa; width: 10%">ìƒíƒœ</th>
                        <th style="background-color: #f8f9fa; width: 6%">ìˆ˜ì •</th>
                    </tr>
                    </thead>
                    <tbody>
                    <th:block th:each="hotelDTO : ${hotelMemberIds}">
                        <tr style="vertical-align: middle;">
                            <td th:text="${hotelDTO.member != null ? hotelDTO.member.memberId : 'N/A'}">1</td>
                            <td>
                                <form th:action="@{/admin/executiveUpdate}" method="post">
                                    <input type="hidden" th:value="${hotelDTO.member != null ? hotelDTO.member.memberId : ''}" name="memberId" />
                                    <select class="form-select" name="role">
                                        <option th:each="role : ${roles}"
                                                th:value="${role}"
                                                th:text="${role}"
                                                th:selected="${hotelDTO.member != null && hotelDTO.member.role == role}">
                                        </option>
                                    </select>
                            </td>
                            <td th:text="${hotelDTO.member != null ? hotelDTO.member.memberEmail : 'N/A'}">ì•„ì´ë””</td>
                            <td th:text="${hotelDTO.member != null ? hotelDTO.member.memberName : 'N/A'}">íšŒì› ì´ë¦„</td>
                            <input type="text" class="form-control" id="memberName" name="memberName" placeholder="ì´ë¦„" th:value="${hotelDTO.member != null ? hotelDTO.member.memberName : 'N/A'}" hidden="hidden">
                            <td>
                                <a th:href="@{/chief/company/read(companyId=${hotelDTO.companyId})}" th:text="${hotelDTO.member != null ? hotelDTO.companyName : 'N/A'}">ë³¸ì‚¬ëª…</a>
                            </td>
                            <td>
                                <a th:href="@{/manager/hotel/read(hotelId=${hotelDTO.hotelId})}" th:text="${hotelDTO.member != null ?  hotelDTO.hotelName : 'N/A'}">ì§€ì‚¬ëª…</a>
                            </td>
                            <td th:text="${hotelDTO.member != null ? hotelDTO.member.memberPhone : 'N/A'}">ì „í™”ë²ˆí˜¸</td>
                            <td th:text="${hotelDTO.regDate != null ? #temporals.format(hotelDTO.modDate, 'yyyy-MM-dd HH:mm') : 'N/A'}">ê°€ì…ì¼</td>
                            <td>
                                <select class="form-select" name="memberStatus">
                                    <option value="í™œì„±" th:selected="${hotelDTO.member != null && hotelDTO.member.memberStatus == 'í™œì„±'}">ğŸŸ¢ í™œì„±</option>
                                    <option value="ë¹„í™œì„±" th:selected="${hotelDTO.member != null && hotelDTO.member.memberStatus == 'ë¹„í™œì„±'}">ğŸ”´ ë¹„í™œì„±</option>
                                </select>
                            </td>
                            <td>
                                <button type="submit" class="btn btn-primary"><i class="bi bi-pen"></i></button>
                            </td>
                            </form>
                        </tr>
                    </th:block>
                </table>
                </table>
                <div th:if="${totalPages > 1}" class="pagination d-flex justify-content-center">
                    <ul class="pagination">
                        <!-- ì´ì „ ë²„íŠ¼ -->
                        <li th:classappend="${pageNumber == 0} ? 'disabled'" class="page-item">
                            <a class="page-link" th:href="@{/admin/memberList(page=${pageNumber - 1}, size=${size}, role=${param.role}, email=${param.email}, status=${param.status}, name=${param.name}, phone=${param.phone}, startDate=${param.startDate}, endDate=${param.endDate})}">ì´ì „</a>
                        </li>

                        <!-- í˜ì´ì§€ ë²ˆí˜¸ ë²„íŠ¼ -->
                        <li th:each="i : ${#numbers.sequence(0, totalPages - 1)}"
                            th:classappend="${i == pageNumber} ? 'active'"
                            class="page-item">
                            <a class="page-link"
                               th:href="@{/admin/memberList(page=${i}, size=${size}, role=${param.role}, email=${param.email}, status=${param.status}, name=${param.name}, phone=${param.phone}, startDate=${param.startDate}, endDate=${param.endDate})}"
                               th:text="${i + 1}">
                            </a>
                        </li>

                        <!-- ë‹¤ìŒ ë²„íŠ¼ -->
                        <li th:classappend="${pageNumber + 1 == totalPages} ? 'disabled'" class="page-item">
                            <a class="page-link" th:href="@{/admin/memberList(page=${pageNumber + 1}, size=${size}, role=${param.role}, email=${param.email}, status=${param.status}, name=${param.name}, phone=${param.phone}, startDate=${param.startDate}, endDate=${param.endDate})}">ë‹¤ìŒ</a>
                        </li>
                    </ul>
                </div>
                <div th:if="${#lists.isEmpty(hotelMemberIds)}" class="alert alert-warning text-center mt-4  ">
                    ì¡°íšŒ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.
                </div>
                <!-- íšŒì›ì •ë³´ ìˆ˜ì • ì„±ê³µì‹œ ë©”ì‹œì§€ -->
                <div id="successMessage" th:if="${successMessage}" class="alert alert-success alert-dismissible fade show" role="alert">
                    <span th:text="${successMessage}"></span>
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>

                <script>
                    window.onload = function() {
                        // íšŒì›ì •ë³´ ìˆ˜ì • ì„±ê³µ ë©”ì‹œì§€ ìˆ¨ê¸°ê¸°
                        var successMessage = document.getElementById('successMessage');
                        if (successMessage) {
                            setTimeout(function() {
                                successMessage.style.display = 'none';
                            }, 5000); // 5ì´ˆ í›„ì— ìˆ¨ê¸°ê¸°
                        }

                        // URL íŒŒë¼ë¯¸í„°ì—ì„œ ê°’ì„ ê°€ì ¸ì˜¤ê¸°
                        var urlParams = new URLSearchParams(window.location.search);

                        // ë³¸ì‚¬ ìœ ì§€
                        var companyId = urlParams.get('companyId');
                        if (companyId) {
                            var companySelect = document.getElementById('companyId');
                            if (companySelect) {
                                for (var i = 0; i < companySelect.options.length; i++) {
                                    if (companySelect.options[i].value === companyId) {
                                        companySelect.selectedIndex = i;
                                        break;
                                    }
                                }

                                // ë³¸ì‚¬ ì„ íƒ í›„ ì§€ì‚¬ ëª©ë¡ì„ ë‹¤ì‹œ ë¶ˆëŸ¬ì˜´
                                loadHotels(companyId);
                            }
                        }

                        // ì§€ì‚¬ ìœ ì§€
                        var hotelId = urlParams.get('hotelId');
                        if (hotelId) {
                            var hotelSelect = document.getElementById('hotelId');
                            if (hotelSelect) {
                                for (var i = 0; i < hotelSelect.options.length; i++) {
                                    if (hotelSelect.options[i].value === hotelId) {
                                        hotelSelect.selectedIndex = i;
                                        break;
                                    }
                                }
                            }
                        }

                        // ìƒíƒœ ìœ ì§€
                        var status = urlParams.get('status');
                        if (status) {
                            var statusInput = document.querySelector("input[name='status'][value='" + status + "']");
                            if (statusInput) {
                                statusInput.checked = true;
                            }
                        }

                        // ê¶Œí•œ ìœ ì§€
                        var role = urlParams.get('role');
                        if (role) {
                            var selectElement = document.getElementById('role');
                            if (selectElement) {
                                for (var i = 0; i < selectElement.options.length; i++) {
                                    if (selectElement.options[i].value === role) {
                                        selectElement.selectedIndex = i;
                                        break;
                                    }
                                }
                            }
                        }
                    };

                    // ë³¸ì‚¬ì— í•´ë‹¹í•˜ëŠ” ì§€ì‚¬ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” í•¨ìˆ˜
                    function loadHotels(companyId) {
                        $.ajax({
                            url: "/admin/hotels",  // ë³¸ì‚¬ì— í•´ë‹¹í•˜ëŠ” ì§€ì‚¬ë¥¼ ê°€ì ¸ì˜¤ëŠ” API
                            type: "GET",
                            data: { companyId: companyId },  // ì„ íƒí•œ íšŒì‚¬ ID ì „ì†¡
                            success: function(hotels) {
                                var hotelId = $("#hotelId");
                                hotelId.empty();  // ê¸°ì¡´ ì˜µì…˜ ì œê±°

                                if (hotels.length > 0) {
                                    // í˜¸í…” ëª©ë¡ì´ ìˆì„ ê²½ìš°
                                    hotelId.append('<option value="">ì „ì²´</option>'); // 'ì „ì²´' ì˜µì…˜ ì¶”ê°€
                                    hotels.forEach(function(hotel) {
                                        hotelId.append(
                                            `<option value="${hotel.hotelId}">${hotel.hotelName}</option>`
                                        );
                                    });
                                } else {
                                    // ì§€ì‚¬ê°€ ì—†ìœ¼ë©´ 'ì§€ì‚¬ ëª©ë¡ì´ ì—†ìŠµë‹ˆë‹¤' ë©”ì‹œì§€ ì¶”ê°€
                                    hotelId.append('<option value="">ì§€ì‚¬ ëª©ë¡ì´ ì—†ìŠµë‹ˆë‹¤</option>');
                                }
                            },
                            error: function() {
                                alert("ì§€ì‚¬ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
                            }
                        });
                    }
                </script>

                <!-- ë“±ë¡ ë²„íŠ¼ -->
                <div class="text-end">
                    <button class="btn btn-dark" onclick="location.href='/admin/executiveRegister'">
                        <i class="bi bi-person-plus-fill"></i> ë§¤ë‹ˆì € ë“±ë¡</button>
                </div>
            </div>
        </div>
            <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
            <script>
                $(document).ready(function() {
                    // #company ì„ íƒ ì‹œ ì‹¤í–‰
                    $("#companyId").change(function() {
                        var companyId = $(this).val(); // ì„ íƒí•œ ë³¸ì‚¬ì˜ ID ê°€ì ¸ì˜¤ê¸°

                        // íšŒì‚¬ IDê°€ ì„ íƒë˜ì§€ ì•Šìœ¼ë©´ ì§€ì‚¬ ëª©ë¡ ì´ˆê¸°í™”
                        if (!companyId) {
                            $("#hotelId").empty();  // ê¸°ì¡´ ì˜µì…˜ ì œê±°
                            $("#hotelId").append('<option value="">ë¨¼ì € ë³¸ì‚¬ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>');
                            return;  // ì¶”ê°€ì ìœ¼ë¡œ ì²˜ë¦¬í•  í•„ìš”ê°€ ì—†ìœ¼ë¯€ë¡œ ì¢…ë£Œ
                        }

                        $.ajax({
                            url: "/admin/hotels",  // ë³¸ì‚¬ì— í•´ë‹¹í•˜ëŠ” ì§€ì‚¬ë¥¼ ê°€ì ¸ì˜¤ëŠ” API
                            type: "GET",
                            data: { companyId: companyId },  // ì„ íƒí•œ íšŒì‚¬ ID ì „ì†¡
                            success: function(hotels) {
                                var hotelId = $("#hotelId");
                                hotelId.empty();  // ê¸°ì¡´ ì˜µì…˜ ì œê±°

                                if (hotels.length > 0) {
                                    hotelId.append('<option value="">ì „ì²´</option>'); // 'ì „ì²´' ì˜µì…˜ ì¶”ê°€
                                    hotels.forEach(function(hotel) {
                                        hotelId.append(
                                            `<option value="${hotel.hotelId}">${hotel.hotelName}</option>`
                                        );
                                    });

                                    // URLì—ì„œ hotelId íŒŒë¼ë¯¸í„°ê°€ ìˆìœ¼ë©´ í•´ë‹¹ ê°’ì„ ìœ ì§€
                                    var selectedHotelId = new URLSearchParams(window.location.search).get('hotelId');
                                    if (selectedHotelId) {
                                        hotelId.val(selectedHotelId); // ì„ íƒëœ ì§€ì‚¬ ìœ ì§€
                                    }
                                } else {
                                    hotelId.append('<option value="">ì§€ì‚¬ ëª©ë¡ì´ ì—†ìŠµë‹ˆë‹¤</option>');
                                }
                            },
                            error: function() {
                                alert("ì§€ì‚¬ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
                            }
                        });
                    });
                });
            </script>
        </div>
    </div>
</div>
</body>
</html>