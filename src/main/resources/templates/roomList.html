<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>
    <meta charset="UTF-8">
    <title>Room List</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/user.css}">
    <link rel="stylesheet" th:href="@{/css/roomList.css}">
</head>
<body>
<div th:replace="~{fragments/header::header}"></div>
<div layout:fragment="content">
    <!-- 룸 배너 이미지 -->
    <section class="banner-container room-bnr">
        <img src="/img/room_banner.jpg" alt="Room Banner">
    </section>

    <!-- Room List Section -->
    <section class="py-5">
        <div class="container">
            <h2 class="text-center mb-5">Room List</h2>
            <div id="room-list" class="row">
                <!-- 동적으로 방 리스트를 출력 -->
                <div class="col-md-4" th:each="room : ${roomList}">
                    <div class="room-card">
                        <div class="room-image">
                            <img th:if="${!#lists.isEmpty(room.roomImageDTOList)}"
                                 th:src="@{'/upload/' + ${room.roomImageDTOList[0].imagePath}}"
                                 class="card-img-top"
                                 th:alt="${room.roomName}">
                            <img th:if="${#lists.isEmpty(room.roomImageDTOList)}"
                                 src="/img/default_img.jpg"
                                 class="card-img-top"
                                 alt="Default Room Image">
                        </div>
                        <div class="room-text">
                            <div class="room-location" th:text="(${room.roomStatus} ? 'Available' : 'Unavailable')"></div>
                            <div class="room-details">
                                <h5 th:text="${room.roomName}"></h5>
                                <p th:text="'Room Type: ' + ${room.roomType}"></p>
                                <p th:text="'Reservation Period: ' + ${room.reservationStart} + ' ~ ' + ${room.reservationEnd}"></p>
                                <p th:text="'Stay Period: ' + ${room.stayStart} + ' ~ ' + ${room.stayEnd}"></p>
                                <div class="room-actions">
                                    <p class="room-price mb-0" th:text="${room.formattedRoomPrice} + ' ' + '~'"></p>
                                    <div class="room-buttons">
                                        <button class="btn btn-dark btn-book">예약하기</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- MORE 버튼 -->
            <div class="text-center mt-4">
                <button id="more-btn" class="btn btn-outline-primary">MORE</button>
            </div>
        </div>
    </section>

    <!-- JavaScript for MORE button -->
    <script>
        document.getElementById('more-btn').addEventListener('click', function () {
            const roomList = document.getElementById('room-list');

            // Fetch additional rooms from the server (dummy example for now)
            fetch('/roomList?page=1')
                .then(response => response.json())
                .then(data => {
                    data.rooms.forEach(room => {
                        const roomCard = `
                            <div class="col-md-4">
                                <div class="room-card">
                                    <div class="room-image">
                                        <img src="${room.image || '/img/default_img.jpg'}" class="card-img-top" alt="Room Image">
                                    </div>
                                    <div class="room-text">
                                        <div class="room-location">${room.status ? 'Available' : 'Unavailable'}</div>
                                        <div class="room-details">
                                            <h5>${room.name}</h5>
                                            <p>Room Type: ${room.type}</p>
                                            <p>Reservation Period: ${room.reservationStart} ~ ${room.reservationEnd}</p>
                                            <p>Stay Period: ${room.stayStart} ~ ${room.stayEnd}</p>
                                            <div class="room-actions">
                                                <p class="room-price mb-0">${room.price} KRW </p>
                                                <button class="btn btn-dark btn-book">예약하기</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>`;
                        roomList.insertAdjacentHTML('beforeend', roomCard);
                    });

                    // Disable MORE button if no more rooms are available
                    if (data.rooms.length === 0) {
                        this.disabled = true;
                        this.textContent = 'No More Rooms';
                    }
                })
                .catch(error => {
                    console.error('Error fetching more rooms:', error);
                    this.textContent = 'Error';
                    this.disabled = true;
                });
        });
    </script>
</div>
<div th:replace="~{fragments/footer::footer}"></div>
</body>
</html>
